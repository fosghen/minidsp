# MiniDSP — минималистичный CLI для генерации и простых операций с сигналами

Проект для практики Rust на задачах цифровой обработки сигналов (DSP). Сейчас это исполняемый бинарь с CLI, умеющий генерировать тестовые сигналы и сохранять их в CSV.

### Ключевые возможности
- Генерация синусоидального сигнала и сохранение в CSV
- Расширяемая структура для генерации шума и свипа (sweep)
- Удобный CLI на `clap`

### Текущее состояние
- Реализовано: парсинг аргументов, команда `gen sine`, запись CSV
- В планах: `gen noise`, `gen sweep`, сохранение/загрузка WAV, фильтры, FFT

## Архитектура

```
src/
├── main.rs      # Точка входа, разбор CLI и маршрутизация команд
├── args.rs      # Описание CLI: команды и флаги (clap)
├── generate.rs  # Логика генераторов сигналов (sine/…)
└── signal.rs    # Общие утилиты для сигналов: SAMPLE_RATE, сохранение и т.п.
```

Связи модулей:
- `main` использует `args::Cli` для парсинга и вызывает соответствующие функции из `generate`
- `generate` опирается на `signal::SAMPLE_RATE` и возвращает `Vec<f64>`
- `signal` предоставляет константы и I/O утилиты (например, `save_csv`)

## API

На текущем этапе проект — бинарь, но внутренние функции можно рассматривать как «внутренний API»:

- Константы и утилиты
  - `signal::SAMPLE_RATE: u32` — частота дискретизации (по умолчанию 10000 Гц)
  - `signal::save_csv(signal: &Vec<f64>, filename: &str) -> std::io::Result<()>` — построчная запись значений в CSV (формат: `<value>;`)

- Генераторы
  - `generate::create_sine(freq: f64, phase: f64, duration: f64, amplitude: f64) -> Vec<f64>` — создает сэмплы синуса указанной длительности

- CLI (бинарь `minidsp`)
  - Команда: `gen`
    - Подкоманды:
      - `sine` — флаги: `--freq <Hz>`, `--phase <rad>`, `--duration <sec>`, `--amplitude <0..>`
      - `noise` — флаги: `--amplitude`, `--std`, `--mu` (заготовка)
      - `sweep` — флаги: `--f0`, `--f1`, `--t1`, `--method`, `--vertex-zero` (заготовка)

## Установка и запуск

```bash
# Клонирование
git clone <your-repo>
cd minigrep

# Сборка
cargo build

# Общая справка
cargo run -- --help

# Справка по генерации
cargo run -- gen --help

# Справка по синусу
cargo run -- gen sine --help
```

## Примеры использования CLI

```bash
# Синус 440 Гц, 2 секунды, амплитуда 0.5, фаза 0 рад
cargo run -- gen sine --freq 440 --duration 2.0 --amplitude 0.5 --phase 0.0

# Результат будет сохранен в CSV (имя вида: sine_<freq>hz.csv), по одному значению на строку
```

Заготовленные команды (реализация в планах):

```bash
# Белый шум с амплитудой 0.3
cargo run -- gen noise --amplitude 0.3 --std 1.0 --mu 0.0

# Линейный свип 100→1000 Гц за 3 секунды
cargo run -- gen sweep --f0 100 --f1 1000 --t1 3.0 --method linear
```

## Разработка и тесты

```bash
# Запуск тестов (есть тесты для парсинга CLI)
cargo test
```

## Roadmap / TODO

### Ближайшие задачи
- [x] Реализовать `gen noise` в `generate.rs` и провести проводку в `main.rs`
- [x] Реализовать `gen sweep` (минимум линейный вариант)
- [x] Выводить имена выходных файлов и путь сохранения в CLI
- [x] Добавить проверку входных параметров (валидаторы для freq/duration/amplitude)
- [x] Написать unit-тесты для `generate::create_sine` и `signal::save_csv`

### Работа с файлами (WAV)
- [ ] Добавить зависимость `hound` и модуль `wav.rs`
- [ ] `save_wav(Vec<f64>)` и `load_wav()` с конвертацией масштабов
- [ ] Добавить флаги CLI для сохранения в WAV (`--wav <path>`) помимо CSV

### Базовые DSP операции
- [ ] `normalize(&mut [f64], target_rms)`
- [ ] `mix(a: &[f64], b: &[f64]) -> Vec<f64>`
- [ ] Тесты на граничные случаи (разные длины, пустые входы)

### Архитектура как библиотеки
- [ ] Вынести общие части в `lib.rs` и сделать экспорт API
- [ ] Док-комментарии и пример использования в rustdoc

### Анализ и визуализация (после базы)
- [ ] FFT (crate `rustfft`), вычисление спектра
- [ ] Опционально — визуализация (например, `plotters`)

## Примечания по стилю
- Код нацелен на читаемость: явные имена, проверяемые инварианты
- Избегать ловли исключений без обработки; отдавать `Result` наверх
- Предпочитать ранние `return` и небольшие функции

## Лицензия
MIT или иная на ваш выбор (добавьте файл LICENSE при необходимости)
